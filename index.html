<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态留言板</title>
    <style>
        :root {
            --note-bg: rgba(44, 62, 80, 0.8); /* 80%透明度 */
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(-45deg, #ff0000, #00ff00, #0000ff, #ffff00);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #ecf0f1;
            min-height: 100vh;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #board {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        .note {
            position: absolute;
            min-width: 220px;
            min-height: 200px;
            padding: 15px;
            background-color: var(--note-bg);
            border-radius: 10px;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
            cursor: grab;
            user-select: none;
            transition: box-shadow 0.3s ease;
        }
        .note:hover {
            box-shadow: 8px 8px 20px rgba(0, 0, 0, 0.4);
        }
        .note textarea {
            width: 100%;
            height: calc(100% - 50px);
            border: none;
            background-color: transparent;
            resize: none;
            font-size: 14px;
            color: inherit;
        }
        .note textarea::placeholder {
            color: rgba(236, 240, 241, 0.5);
        }
        .note .controls {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .note button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .note button:hover {
            background-color: #c0392b;
        }
        .note input[type="color"] {
            width: 30px;
            height: 30px;
            border: none;
            cursor: pointer;
            background: none;
        }
        .note .resize-handle {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 10px;
            height: 10px;
            background-color: #e74c3c;
            cursor: se-resize;
            border-radius: 2px;
        }
        #controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
        }
        #newNote {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
        }
        #saveBtn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 600px) {
            .note {
                width: 150px;
                height: 150px;
            }
            #controls {
                flex-direction: column;
                bottom: 10px;
                left: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="board"></div>
    <div id="controls">
        <button id="newNote">新建便签</button>
        <button id="saveBtn">保存数据</button>
    </div>

    <script>
        // 数据存储功能
        const DATA_FILE = 'data.txt';
        
        // 初始化事件监听
        document.getElementById('newNote').addEventListener('click', createNewNote);
        document.getElementById('saveBtn').addEventListener('click', saveAllNotes);

        // 从本地存储加载数据
        function loadNotes() {
            try {
                const data = localStorage.getItem('notesData') || '[]';
                const notes = JSON.parse(data);
                notes.forEach(note => createNoteElement(note));
            } catch (error) {
                console.error('数据加载失败:', error);
            }
        }

        // 保存数据到本地存储
        function saveAllNotes() {
            const notes = [];
            document.querySelectorAll('.note').forEach(note => {
                notes.push({
                    id: note.dataset.id,
                    text: note.querySelector('textarea').value,
                    top: note.style.top,
                    left: note.style.left,
                    color: note.style.color,
                    width: note.style.width,
                    height: note.style.height
                });
            });
            
            localStorage.setItem('notesData', JSON.stringify(notes));
            
            // 创建虚拟文件下载
            const blob = new Blob([JSON.stringify(notes)], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = DATA_FILE;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 创建新便签
        function createNewNote() {
            const id = Date.now().toString();
            createNoteElement({
                id,
                text: '',
                top: `${Math.random() * 80 + 10}%`,
                left: `${Math.random() * 80 + 10}%`,
                color: '#ecf0f1',
                width: '220px',
                height: '200px'
            });
        }

        // 创建便签元素
        function createNoteElement(noteData) {
            const note = document.createElement('div');
            note.className = 'note';
            note.style.top = noteData.top;
            note.style.left = noteData.left;
            note.style.width = noteData.width;
            note.style.height = noteData.height;
            note.style.color = noteData.color;
            note.dataset.id = noteData.id;

            // 文本区域
            const textarea = document.createElement('textarea');
            textarea.value = noteData.text;
            textarea.placeholder = '输入留言...';

            // 控制栏
            const controls = document.createElement('div');
            controls.className = 'controls';

            // 颜色选择
            const colorPicker = document.createElement('input');
            colorPicker.type = 'color';
            colorPicker.value = noteData.color;
            colorPicker.oninput = () => {
                note.style.color = colorPicker.value;
            };

            // 删除按钮
            const deleteBtn = document.createElement('button');
            deleteBtn.innerText = '删除';
            deleteBtn.onclick = () => note.remove();

            controls.appendChild(colorPicker);
            controls.appendChild(deleteBtn);
            note.appendChild(textarea);
            note.appendChild(controls);

            // 调整手柄
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            note.appendChild(resizeHandle);

            document.getElementById('board').appendChild(note);

            // 拖动功能
            setupDragAndResize(note);
        }

        // 设置拖动和调整大小
        function setupDragAndResize(note) {
            let isDragging = false;
            let isResizing = false;
            let startX, startY, startWidth, startHeight;

            // 鼠标按下事件
            note.addEventListener('mousedown', (e) => {
                if (e.target === note.querySelector('.resize-handle')) {
                    isResizing = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = note.offsetWidth;
                    startHeight = note.offsetHeight;
                } else {
                    isDragging = true;
                    const rect = note.getBoundingClientRect();
                    startX = e.clientX - rect.left;
                    startY = e.clientY - rect.top;
                }
            });

            // 鼠标移动事件
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    note.style.left = `${e.clientX - startX}px`;
                    note.style.top = `${e.clientY - startY}px`;
                }
                if (isResizing) {
                    const newWidth = startWidth + (e.clientX - startX);
                    const newHeight = startHeight + (e.clientY - startY);
                    note.style.width = `${newWidth}px`;
                    note.style.height = `${newHeight}px`;
                }
            });

            // 鼠标释放事件
            document.addEventListener('mouseup', () => {
                isDragging = false;
                isResizing = false;
            });
        }

        // 初始化加载
        loadNotes();
    </script>
</body>
</html>